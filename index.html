<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"lyuane.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.9.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="路漫漫其修远兮,吾将上下而求索">
<meta property="og:type" content="website">
<meta property="og:title" content="沄渊">
<meta property="og:url" content="http://lyuane.github.io/index.html">
<meta property="og:site_name" content="沄渊">
<meta property="og:description" content="路漫漫其修远兮,吾将上下而求索">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="沄渊">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://lyuane.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>沄渊</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">沄渊</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">守得云开见月明</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="沄渊"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">沄渊</p>
  <div class="site-description" itemprop="description">路漫漫其修远兮,吾将上下而求索</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://lyuane.github.io/2022/01/10/github-pages%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D%E8%BF%87%E6%9C%9F%EF%BC%8C%E4%BD%86%E6%98%AF%E8%A7%A3%E6%9E%90%E8%BF%98%E5%9C%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="沄渊">
      <meta itemprop="description" content="路漫漫其修远兮,吾将上下而求索">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沄渊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/10/github-pages%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D%E8%BF%87%E6%9C%9F%EF%BC%8C%E4%BD%86%E6%98%AF%E8%A7%A3%E6%9E%90%E8%BF%98%E5%9C%A8/" class="post-title-link" itemprop="url">github pages绑定域名过期，但是解析还在</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-10 14:34:46" itemprop="dateCreated datePublished" datetime="2022-01-10T14:34:46+08:00">2022-01-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>之前github.io的博客绑定了阿里云的域名，但是域名现在过期。</p>
<p>通过username.github.io 访问还是会跳到绑定的域名</p>
<h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><p>绑定域名时在github创建CNAME后会对域名进行缓存，导致每次解析重定向到绑定的域名</p>
<p>ps：想想在配置的时候不仅要在域名平台进行配置，还要在github配置CNAME，双向认证。</p>
<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><ul>
<li>清空CNAME，再提交一次（本质是通过改变CNAME来更新github的缓存）</li>
<li>如果是删除了项目，可以新建同名项目并提交空CNAME文件</li>
</ul>
<h1 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h1><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/CNAME%E8%AE%B0%E5%BD%95">https://zh.wikipedia.org/wiki/CNAME%E8%AE%B0%E5%BD%95</a></p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/205660.html">https://help.aliyun.com/document_detail/205660.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://lyuane.github.io/2021/12/22/2020-10-%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="沄渊">
      <meta itemprop="description" content="路漫漫其修远兮,吾将上下而求索">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沄渊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/22/2020-10-%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-22 19:15:01" itemprop="dateCreated datePublished" datetime="2021-12-22T19:15:01+08:00">2021-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="内容分发的方式"><a href="#内容分发的方式" class="headerlink" title="内容分发的方式"></a>内容分发的方式</h1><p>门户网站</p>
<p>搜索引擎</p>
<p>社交网络</p>
<p>兴趣社区</p>
<p>推荐系统</p>
<h1 id="定义做推荐的中长短期目标"><a href="#定义做推荐的中长短期目标" class="headerlink" title="定义做推荐的中长短期目标"></a>定义做推荐的中长短期目标</h1><p>短期目标：用户看到后表现一定的动作</p>
<p>中期目标：用户能持续使用app</p>
<p>长期目标：用户长期留存（靠产品）</p>
<h1 id="两阶段的设计"><a href="#两阶段的设计" class="headerlink" title="两阶段的设计"></a>两阶段的设计</h1><p>召回：以策略为导向，找到和用户相关的，或者用户可能感兴趣的</p>
<p>排序：以短期目标为导向，找到</p>
<p>召回：在10ms里，从2000w找出500个视频，然后计算</p>
<h1 id="如何预测用户点击的概率"><a href="#如何预测用户点击的概率" class="headerlink" title="如何预测用户点击的概率"></a>如何预测用户点击的概率</h1><p>用户特征：</p>
<p>​    id    用户点击的文章列表  文章关键词分布    作者分布</p>
<p>文章特征</p>
<p>​    作者  关键词</p>
<p>交叉特征</p>
<p>​    用户点击过该文章作者发表的其他文章</p>
<p>​    用户有没有点击过关键词类似的其他文章</p>
<h1 id="如何判断用户会不会点"><a href="#如何判断用户会不会点" class="headerlink" title="如何判断用户会不会点"></a>如何判断用户会不会点</h1><p>模型</p>
<h1 id="推荐并不只考虑点击率"><a href="#推荐并不只考虑点击率" class="headerlink" title="推荐并不只考虑点击率"></a>推荐并不只考虑点击率</h1><p>更多的用户行为：阅读时长、评论、分享、关注、点赞等等</p>
<h1 id="用户兴趣vs作者生态"><a href="#用户兴趣vs作者生态" class="headerlink" title="用户兴趣vs作者生态"></a>用户兴趣vs作者生态</h1><p>最好满足用户兴趣的算法不一定能形成好的作者生态</p>
<p>作者欺骗用户：标题党、封面党、低俗、骗赞、骗评论等</p>
<h1 id="用户兴趣vs多样性"><a href="#用户兴趣vs多样性" class="headerlink" title="用户兴趣vs多样性"></a>用户兴趣vs多样性</h1><p>给用户信息增量，而不是重复的东西：消重和打散</p>
<p>拿出一部分流量主动探索未知的兴趣</p>
<h1 id="文章冷启动"><a href="#文章冷启动" class="headerlink" title="文章冷启动"></a>文章冷启动</h1><p>新文章pk落下风</p>
<p>对新文章冷启动机制，保证新文章在展现x次之前的更大获胜概率</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://lyuane.github.io/2021/12/22/2021-08-%E6%85%A2%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="沄渊">
      <meta itemprop="description" content="路漫漫其修远兮,吾将上下而求索">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沄渊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/22/2021-08-%E6%85%A2%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-22 19:15:01" itemprop="dateCreated datePublished" datetime="2021-12-22T19:15:01+08:00">2021-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="业务场景-慢查询优化问题"><a href="#业务场景-慢查询优化问题" class="headerlink" title="业务场景-慢查询优化问题"></a>业务场景-慢查询优化问题</h1><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>某个表下有两个字段：status、extensionField（业务拓展字段）</p>
<p>线上业务高峰期，大量processing任务时，表里只有status索引，大量</p>
<p>select count(1) from tableName where status in (“processing”) and extensionField = “xxx”</p>
<p>引发大量物理页读取，进而导致DB大量慢查询、CPU飙高，整体性能受到影响。</p>
<h3 id="难点"><a href="#难点" class="headerlink" title="难点"></a>难点</h3><p>extensionField类型为varchar(512)，字段较大，无法做完整的联合索引</p>
<p>extensionField业务方可扩展，框架代码无法限制字段长度</p>
<h3 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h3><p>不做完全精确的count，使用SHA-256算法对extensionField字段进行hash（碰撞概率可以忽略）</p>
<h3 id="上线"><a href="#上线" class="headerlink" title="上线"></a>上线</h3><ol>
<li>表结构升级，增加extensionField_sha256_str字段，并增加status、extensionField_sha256_str联合索引</li>
<li>上线功能：在存储extensionField时一同存储extensionField_sha256_str</li>
<li>编写脚本，遍历该表，填充历史数据extensionField_sha256_str</li>
<li>上线功能：在查询时用到status、extensionField_sha256_str联合索引</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://lyuane.github.io/2020/03/05/2020-03-05-%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%AE%89%E5%85%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="沄渊">
      <meta itemprop="description" content="路漫漫其修远兮,吾将上下而求索">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沄渊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/05/2020-03-05-%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%AE%89%E5%85%A8/" class="post-title-link" itemprop="url">智能合约安全</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-05 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-05T00:00:00+08:00">2020-03-05</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="0x00-常见solidity漏洞类型"><a href="#0x00-常见solidity漏洞类型" class="headerlink" title="0x00 常见solidity漏洞类型"></a>0x00 常见solidity漏洞类型</h2><p>目录参照<a target="_blank" rel="noopener" href="https://dasp.co/">DASP</a></p>
<ol>
<li>Reentrancy - 重入</li>
<li>Access Control - 访问控制</li>
<li>Arithmetic Issues - 算术问题（整数上下溢出）</li>
<li>Unchecked Return Values For Low Level Calls - 未严格判断不安全函数调用返回值</li>
<li>Denial of Service - 拒绝服务</li>
<li>Bad Randomness - 可预测的随机处理</li>
<li>Front Running</li>
<li>Time manipulation</li>
<li>Short Address Attack - 短地址攻击</li>
<li>Unknown Unknowns - 其他未知</li>
</ol>
<h2 id="0x01-Reentrancy-重入"><a href="#0x01-Reentrancy-重入" class="headerlink" title="0x01 Reentrancy-重入"></a>0x01 Reentrancy-重入</h2><p>见<a target="_blank" rel="noopener" href="http://firstking.top/2020/02/23/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%AE%89%E5%85%A8-Reentrancy(%E9%87%8D%E5%85%A5%E6%94%BB%E5%87%BB)/">智能合约安全-Reentrancy(重入攻击)</a></p>
<h2 id="0x02-Access-Control-访问控制-delegatecall"><a href="#0x02-Access-Control-访问控制-delegatecall" class="headerlink" title="0x02 Access Control - 访问控制      delegatecall()"></a>0x02 Access Control - 访问控制      delegatecall()</h2><ul>
<li><code>call</code> 的外部调用上下文是外部合约</li>
<li><code>delegatecall</code> 的外部调用上下是调用合约上下文</li>
</ul>
<p>合约 A 以 <code>call</code> 方式调用外部合约 B 的 <code>func()</code> 函数，在外部合约 B 上下文执行完 <code>func()</code> 后继续返回 A 合约上下文继续执行；而当 A 以 <code>delegatecall</code> 方式调用时，相当于将外部合约 B 的 <code>func()</code> 代码复制过来（其函数中涉及的变量或函数都需要存在）在 A 上下文空间中执行。</p>
<p>下面代码是 OpenZeppelin CTF 中的题目：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract Delegate &#123;</span><br><span class="line">    address public owner;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Delegate</span>(<span class="params">address _owner</span>) </span>&#123;</span><br><span class="line">        owner = _owner;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">pwn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Delegation &#123;</span><br><span class="line">    address public owner;</span><br><span class="line">    Delegate delegate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Delegation</span>(<span class="params">address _delegateAddress</span>) </span>&#123;</span><br><span class="line">        delegate = Delegate(_delegateAddress);</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delegate.delegatecall(msg.data)) &#123;</span><br><span class="line">            <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>仔细分析代码，合约 Delegation 在 fallback 函数中使用 <code>msg.data</code> 对 Delegate 实例进行了 <code>delegatecall()</code> 调用。msg.data 可控，这里攻击者直接用 <code>bytes4(keccak256(&quot;pwn()&quot;))</code> 即可通过 <code>delegatecall()</code> 将已部署的 Delegation <code>owner</code> 修改为攻击者自己（msg.sender）</p>
<h2 id="0x03-Arithmetic-Over"><a href="#0x03-Arithmetic-Over" class="headerlink" title="0x03 Arithmetic Over"></a>0x03 Arithmetic Over</h2><p>经典的算术溢出问题，不赘述</p>
<h4 id="预防"><a href="#预防" class="headerlink" title="预防"></a>预防</h4><ul>
<li>在算术逻辑前后进行验证</li>
<li>直接使用 OpenZeppelin 维护的一套智能合约函数库中的 <a target="_blank" rel="noopener" href="https://github.com/OpenZeppelin/openzeppelin-solidity/blob/master/contracts/math/SafeMath.sol">SafeMath</a> 来处理算术逻辑。</li>
</ul>
<h2 id="0x04-Unchecked-Return-Values-For-Low-Level-Calls-未严格判断不安全函数调用返回值"><a href="#0x04-Unchecked-Return-Values-For-Low-Level-Calls-未严格判断不安全函数调用返回值" class="headerlink" title="0x04 Unchecked Return Values For Low Level Calls - 未严格判断不安全函数调用返回值"></a>0x04 Unchecked Return Values For Low Level Calls - 未严格判断不安全函数调用返回值</h2><p>通常通过该<code>transfer()</code>方法将以太币发送到外部帐户。但是，<code>send()</code>也可以使用该功能，并且对于更通用的外部调用，<code>CALL</code>可以直接使用操作码。在<code>call()</code>和<code>send()</code>函数返回一个布尔值，指示如果调用成功还是失败。因此，这些函数有一个简单的警告，即如果外部调用（由<code>call()</code>或初始化<code>send()</code>）失败，则执行这些函数的事务将不会还原，而只会返回<code>call()</code>或。当不检查返回值时，会出现一个常见的陷阱，而不是开发人员希望发生还原的情况。</p>
<p>这里以一个简单的示例来说明严格验证底层调用返回值的重要性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">withdraw</span>(<span class="params">uint256 _amount</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(balances[msg.sender] &gt;= _amount);</span><br><span class="line">    balances[msg.sender] -= _amount;</span><br><span class="line">    etherLeft -= _amount;</span><br><span class="line">    msg.sender.send(_amount);  <span class="comment">// 未验证 send() 返回值，若 msg.sender 为合约账户 fallback() 调用失败，则 send() 返回 false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面给出的提币流程中使用 <code>send()</code> 函数进行转账，因为这里没有验证 <code>send()</code> 返回值，如果 msg.sender 为合约账户 fallback() 调用失败，则 send() 返回 false，最终导致账户余额减少了，钱却没有拿到。</p>
<h2 id="0x05-Denial-of-Service-拒绝服务"><a href="#0x05-Denial-of-Service-拒绝服务" class="headerlink" title="0x05 Denial of Service - 拒绝服务"></a>0x05 Denial of Service - 拒绝服务</h2><p>下面一个例子（代码改自 DASP 中例子）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.10</span>;</span><br><span class="line"></span><br><span class="line">contract PresidentOfCountry &#123;</span><br><span class="line">    address public president;</span><br><span class="line">    uint256 price;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">PresidentOfCountry</span>(<span class="params">uint256 _price</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(_price &gt; <span class="number">0</span>);</span><br><span class="line">        price = _price;</span><br><span class="line">        president = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">becomePresident</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.value &gt;= price); <span class="comment">// must pay the price to become president</span></span><br><span class="line">        president.transfer(price);   <span class="comment">// we pay the previous president</span></span><br><span class="line">        president = msg.sender;      <span class="comment">// we crown the new president</span></span><br><span class="line">        price = price * <span class="number">2</span>;           <span class="comment">// we double the price to become president</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个简单的类似于 KingOfEther 的合约，按合约的正常逻辑任何出价高于合约当前 <code>price</code> 的都能成为新的 president，原有合约里的存款会返还给上一人 president，并且这里也使用了 <code>transfer()</code> 来进行 Ether 转账，看似没有问题的逻辑，但不要忘了，以太坊中有两类账户类型，如果发起 <code>becomePresident()</code> 调用的是个合约账户，并且成功获取了 president，如果其 fallback() 函数恶意进行了类似 <code>revert()</code> 这样主动跑出错误的操作，那么其他账户也就无法再正常进行 becomePresident 逻辑成为 president 了。</p>
<h2 id="0x06-Bad-Randomness-可预测的随机处理"><a href="#0x06-Bad-Randomness-可预测的随机处理" class="headerlink" title="0x06 Bad Randomness - 可预测的随机处理"></a>0x06 Bad Randomness - 可预测的随机处理</h2><p>类似于php的随机数种子爆破</p>
<p>因为链上数据是公开的(即使使私有数据)，因此合约上的存储数据都能在链上查询得到。</p>
<p>如果合约代码没有严格考虑到链上数据公开的问题去使用随机数，可能会被攻击者恶意利用来进行 “作弊”。</p>
<p>摘自 DASP 的代码块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">uint256 private seed;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">play</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">payable</span> </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(msg.value &gt;= <span class="number">1</span> ether);</span><br><span class="line">    iteration++;</span><br><span class="line">    uint randomNumber = uint(keccak256(seed + iteration));</span><br><span class="line">    <span class="keyword">if</span> (randomNumber % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        msg.sender.transfer(<span class="built_in">this</span>.balance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里 <code>seed</code> 变量被标记为了私有变量，前面有说过链上的数据都是公开的，<code>seed</code> 的值可以通过扫描与该合约相关的 TX 来获得。获取 <code>seed</code> 值后，同样的 <code>iteration</code> 值也是可以得到的，那么整个 <code>uint(keccak256(seed + iteration))</code> 的值就是可预测的了</p>
<h2 id="0x07-Front-Running-提前交易"><a href="#0x07-Front-Running-提前交易" class="headerlink" title="0x07 Front Running - 提前交易"></a>0x07 Front Running - 提前交易</h2><p>简单来说，“提前交易”就是某人提前获取到交易者的具体交易信息（或者相关信息），抢在交易者完成操作之前，通过一系列手段（通常是提高报价）来抢在交易者前面完成交易。</p>
<p>让我们来看一个简单的例子。考虑合同<code>FindThisHash.sol</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">contract FindThisHash &#123;</span><br><span class="line">    bytes32 constant public hash = <span class="number">0xb5b5b97fafd9855eec9b41f74dfb6c38f5951141f9a3ecd7f44d5479b630ee0a</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title">constructor</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">payable</span> &#123;&#125; <span class="comment">// load with ether</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">solve</span>(<span class="params">string solution</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        <span class="comment">// If you can find the pre image of the hash, receive 1000 ether</span></span><br><span class="line">        <span class="built_in">require</span>(hash == sha3(solution));</span><br><span class="line">        msg.sender.transfer(<span class="number">1000</span> ether);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>想象一下，该合约包含1000个以太币。可以找到sha3哈希的原像的用户<code>0xb5b5b97fafd9855eec9b41f74dfb6c38f5951141f9a3ecd7f44d5479b630ee0a</code>可以提交解决方案并检索1000个以太币。假设有一位用户认为解决方案是<code>Ethereum!</code>。他们<code>solve()</code>以<code>Ethereum!</code>作为参数调用。不幸的是，攻击者足够聪明，可以监视任何提交解决方案的交易池。他们看到此解决方案，检查其有效性，然后提交等效交易，且交易价格<code>gasPrice</code>比原始交易要高得多。解决区块的矿工可能会因为更高的优先级而给予攻击者优先，<code>gasPrice</code>并在原始解决者之前接受他们的交易。攻击者将获得1000个以太币，而解决该问题的用户将一无所获（合同中没有剩余的以太币）。</p>
<h2 id="0x08-Time-manipulation"><a href="#0x08-Time-manipulation" class="headerlink" title="0x08 Time manipulation"></a>0x08 Time manipulation</h2><p>矿工具有微调时间戳的能力，如果在智能合约中不正确使用区块时间戳，可能会非常危险。</p>
<p><code>roulette.sol</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">contract Roulette &#123;</span><br><span class="line">    uint public pastBlockTime; <span class="comment">// Forces one bet per block</span></span><br><span class="line"></span><br><span class="line">    <span class="title">constructor</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">payable</span> &#123;&#125; <span class="comment">// initially fund contract</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// fallback function used to make a bet</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params"></span>) <span class="title">public</span> <span class="title">payable</span> </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.value == <span class="number">10</span> ether); <span class="comment">// must send 10 ether to play</span></span><br><span class="line">        <span class="built_in">require</span>(now != pastBlockTime); <span class="comment">// only 1 transaction per block</span></span><br><span class="line">        pastBlockTime = now;</span><br><span class="line">        <span class="keyword">if</span>(now % <span class="number">15</span> == <span class="number">0</span>) &#123; <span class="comment">// winner</span></span><br><span class="line">            msg.sender.transfer(<span class="built_in">this</span>.balance);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该合同的行为就像是简单的彩票。每个区块一笔交易可以押注<code>10 ether</code>赢得合同余额的机会。这里的假设是，<code>block.timestamp</code>在最后两位数字周围均匀分布。如果真是这样，将有1/15的机会赢得此彩票。</p>
<p>但是，据我们所知，矿工可以根据需要调整时间戳。在此特定情况下，如果合同中有足够的以太币，则激励解决区块的矿工选择时间戳记，使15等于<code>block.timestamp</code>。这样做，他们可以赢得锁定在该合约中的以太币以及整体奖励。由于每次只允许一个人下注，因此这也容易受到front-running攻击</p>
<h2 id="0x09-Short-Address-Attack-短地址攻击"><a href="#0x09-Short-Address-Attack-短地址攻击" class="headerlink" title="0x09 Short Address Attack - 短地址攻击"></a>0x09 Short Address Attack - 短地址攻击</h2><p>如果我们想调用智能合约的函数，需要在交易的payload字段中填充一段字节码。以ERC20的transfer()的函数为例，函数原型为：</p>
<p>function transfer(address to, uint amount) public returns (bool success);</p>
<p>我们需要通过一段68个字节的字节码来调用该函数进行转账，比如：</p>
<p>a9059cbb000000000000000000000000146aed09cd9dea7a64de689c5d3ef73d2ee5ca000000000000000000000000000000000000000000000000000000000000000001</p>
<p>具体可以分解为3个部分：</p>
<p>4字节函数签名：a9059cbb<br>to参数：000000000000000000000000146aed09cd9dea7a64de689c5d3ef73d2ee5ca00<br>amount参数：0000000000000000000000000000000000000000000000000000000000000001</p>
<p>大家可能注意到，这个转账地址有点特殊：最后两个数字为0。</p>
<p>假如有个用户“不小心”忘记输入最后这两个0了怎么办？这样我们的输入就只有67个字节了。EVM是通过CALLDATALOAD指令从输入数据中获取函数参数的，因此它会先从后面的amount参数里“借”两个0来补足前面的地址参数。当它要加载amount参数的时候，发现位数不够，会在右边补0</p>
<p>所以，经过这么一折腾，实际上EVM看到是下面这些参数：</p>
<p>4字节函数签名：a9059cbb<br>to参数：000000000000000000000000146aed09cd9dea7a64de689c5d3ef73d2ee5ca00(借0)<br>amount参数：0000000000000000000000000000000000000000000000000000000000000100(补0)<br>这样转账地址没变，但是转账金额增大了256倍。</p>
<p>现在基本上用不了了，都作了地址检查。</p>
<h2 id="Refer"><a href="#Refer" class="headerlink" title="Refer"></a>Refer</h2><p><a target="_blank" rel="noopener" href="https://dasp.co/">https://dasp.co/</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.sigmaprime.io/solidity-security.html#delegatecall">https://blog.sigmaprime.io/solidity-security.html#delegatecall</a></p>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/601">https://paper.seebug.org/601</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://lyuane.github.io/2020/02/23/2020-02-23-%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%AE%89%E5%85%A8-Reentrancy(%E9%87%8D%E5%85%A5%E6%94%BB%E5%87%BB)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="沄渊">
      <meta itemprop="description" content="路漫漫其修远兮,吾将上下而求索">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沄渊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/23/2020-02-23-%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%AE%89%E5%85%A8-Reentrancy(%E9%87%8D%E5%85%A5%E6%94%BB%E5%87%BB)/" class="post-title-link" itemprop="url">智能合约安全-Reentrancy(重入攻击)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-23 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-23T00:00:00+08:00">2020-02-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="0x01-重入攻击"><a href="#0x01-重入攻击" class="headerlink" title="0x01 重入攻击"></a>0x01 重入攻击</h2><p>重入攻击是由于solidity智能合约的特性，再加上编写不当造成的。</p>
<p>主要流程为：攻击者编写攻击合约，调用受害合约，利用自己的fallback函数，循环调用受害合约的代码。</p>
<p>臭名昭著的DAO攻击就是因为当时他们的智能合约中存在Re-Entrancy这个bug，ETC也是因为这个bug，硬分叉产生出来的链。</p>
<h2 id="0x02-fallback-函数"><a href="#0x02-fallback-函数" class="headerlink" title="0x02 fallback()函数"></a>0x02 fallback()函数</h2><p>根据<a target="_blank" rel="noopener" href="https://solidity.readthedocs.io/en/v0.6.3/contracts.html#fallback-function">官方文档v0.6.3介绍</a>，fallback函数介绍如下</p>
<blockquote>
<p>A contract can have at most one <code>fallback</code> function, declared using <code>fallback () external [payable]</code>(without the <code>function</code> keyword). This function cannot have arguments, cannot return anything and must have <code>external</code> visibility. It is executed on a call to the contract if none of the other functions match the given function signature, or if no data was supplied at all and there is no <a target="_blank" rel="noopener" href="https://solidity.readthedocs.io/en/v0.6.3/contracts.html#receive-ether-function">receive Ether function</a>. The fallback function always receives data, but in order to also receive Ether it must be marked <code>payable</code>.</p>
</blockquote>
<p>也就是说在如下两种情况下会执行fallback()函数</p>
<ul>
<li>当外部账户或其他合约向该合约地址发送 ether 时；</li>
<li>当外部账户或其他合约调用了该合约一个不存在的函数时；</li>
</ul>
<p>note：一个没有定义回退函数的合约，如果接收ether，会触发异常，并返还ether（solidity v0.4.0开始）。所以合约要接收ether，必须实现回退函数。</p>
<p>如下所示:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract Test &#123;</span><br><span class="line">    <span class="comment">// This function is called for all messages sent to</span></span><br><span class="line">    <span class="comment">// this contract (there is no other function).</span></span><br><span class="line">    <span class="comment">// Sending Ether to this contract will cause an exception,</span></span><br><span class="line">    <span class="comment">// because the fallback function does not have the &quot;payable&quot;</span></span><br><span class="line">    <span class="comment">// modifier.</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; x = <span class="number">1</span>; &#125;</span><br><span class="line">    uint x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// This contract keeps all Ether sent to it with no way</span></span><br><span class="line"><span class="comment">// to get it back.</span></span><br><span class="line">contract Sink &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) <span class="title">payable</span> </span>&#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract Caller &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">callTest</span>(<span class="params">Test test</span>) </span>&#123;</span><br><span class="line">        test.call(<span class="number">0xabcdef01</span>); <span class="comment">// hash does not exist</span></span><br><span class="line">        <span class="comment">// results in test.x becoming == 1.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// The following call will fail, reject the</span></span><br><span class="line">        <span class="comment">// Ether and return false:</span></span><br><span class="line">        test.send(<span class="number">2</span> ether);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="0x03-实例"><a href="#0x03-实例" class="headerlink" title="0x03 实例"></a>0x03 实例</h2><p>引用自<a target="_blank" rel="noopener" href="https://blog.sigmaprime.io/solidity-security.html">https://blog.sigmaprime.io/solidity-security.html</a></p>
<p>为了说明重入攻击流程，考虑如下合约。</p>
<p>EtherStore.sol：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//该合约充当以太坊保险库，允许存款人每周只提取 1 个 Ether。</span></span><br><span class="line">contract EtherStore &#123;</span><br><span class="line"></span><br><span class="line">    uint256 public withdrawalLimit = <span class="number">1</span> ether;</span><br><span class="line">    mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint256) public lastWithdrawTime;</span><br><span class="line">    mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint256) public balances;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">depositFunds</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">payable</span> </span>&#123;</span><br><span class="line">        balances[msg.sender] += msg.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">withdrawFunds</span> (<span class="params">uint256 _weiToWithdraw</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(balances[msg.sender] &gt;= _weiToWithdraw);</span><br><span class="line">        <span class="comment">// limit the withdrawal</span></span><br><span class="line">        <span class="built_in">require</span>(_weiToWithdraw &lt;= withdrawalLimit);</span><br><span class="line">        <span class="comment">// limit the time allowed to withdraw</span></span><br><span class="line">        <span class="built_in">require</span>(now &gt;= lastWithdrawTime[msg.sender] + <span class="number">1</span> weeks);</span><br><span class="line">        <span class="built_in">require</span>(msg.sender.call.value(_weiToWithdraw)());</span><br><span class="line">        balances[msg.sender] -= _weiToWithdraw;</span><br><span class="line">        lastWithdrawTime[msg.sender] = now;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>该合约有两个公共职能。 <code>depositFunds()</code> 和 <code>withdrawFunds()</code> 。</p>
<p>该 <code>depositFunds()</code> 功能只是增加发件人余额。</p>
<p>该 <code>withdrawFunds()</code> 功能允许发件人指定要撤回的 wei 的数量。如果所要求的退出金额小于 1Ether 并且在上周没有发生撤回，它才会成功。</p>
<p><strong>那么漏洞出现在哪呢？</strong></p>
<p><strong>漏洞出现在17行<code>require(msg.sender.call.value(_weiToWithdraw)());</code></strong></p>
<p><strong>当该合约向用户发送ether时，就会调用用户的fallback函数。</strong></p>
<p><strong>如果该用户是恶意的，就可以通过修改自己的fallback函数来控制程序流程。</strong></p>
<p>考虑如下攻击合约</p>
<p>Attack.sol：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;EtherStore.sol&quot;</span>;</span><br><span class="line"></span><br><span class="line">contract Attack &#123;</span><br><span class="line">  EtherStore public etherStore;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// intialise the etherStore variable with the contract address</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">address _etherStoreAddress</span>)</span> &#123;</span><br><span class="line">      etherStore = EtherStore(_etherStoreAddress);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">pwnEtherStore</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">payable</span> </span>&#123;</span><br><span class="line">      <span class="comment">// attack to the nearest ether</span></span><br><span class="line">      <span class="built_in">require</span>(msg.value &gt;= <span class="number">1</span> ether);</span><br><span class="line">      <span class="comment">// send eth to the depositFunds() function</span></span><br><span class="line">      etherStore.depositFunds.value(<span class="number">1</span> ether)();</span><br><span class="line">      <span class="comment">// start the magic</span></span><br><span class="line">      etherStore.withdrawFunds(<span class="number">1</span> ether);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">collectEther</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">      msg.sender.transfer(<span class="built_in">this</span>.balance);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// fallback function - where the magic happens</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"></span>) <span class="title">payable</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (etherStore.balance &gt; <span class="number">1</span> ether) &#123;</span><br><span class="line">          etherStore.withdrawFunds(<span class="number">1</span> ether);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>攻击者可以（假定恶意合约地址为 <code>0x0...123</code>）使用 <code>EtherStore</code> 合约地址作为构造函数参数来创建上述合约。这将初始化并将公共变量 <code>etherStore</code> 指向我们想要攻击的合约。</p>
<p>然后攻击者会调用这个 <code>pwnEtherStore()</code> 函数，并存入一些 Ehter（大于或等于1），比方说 1Ehter，在这个例子中。在这个例子中，我们假设一些其他用户已经将若干 Ehter 存入这份合约中，比方说它的当前余额就是 <code>10 ether</code> 。然后会发生以下情况：</p>
<ol>
<li>Attack.sol - 第15行- EtherStore 合约的 depositFunds() 函数将被调用，其中msg.value 为1 Ether（以及大量的Gas）。发件人（msg.sender）将是我们的恶意合约（0x0 … 123）。因此，balances[0x0..123] = 1Ether。</li>
<li>Attack.sol - 第17行- 然后恶意合约将使用1 ether的参数调用EtherStore合约的withdrawFunds()函数。这将通过所有require语句（EtherStore合约的第[12] - [16]行），因为我们之前没有提取过。</li>
<li>EtherStore.sol - 第17行- 然后合约将1以太币发回恶意合约。</li>
<li>Attack.sol - 第25行- 发送给恶意合约的以太币将执行回退函数。</li>
<li>Attack.sol - 第26行- EtherStore 合约的总余额为10个以太币，现在为9个以太币，因此if语句通过。</li>
<li>Attack.sol - 第27行– 回退函数再次调用 EtherStore 的 withdrawFunds() 函数并“重新进入” EtherStore 合约。</li>
<li>EtherStore.sol - 第11行- 在第二次调用 withdrawFunds() 时，我们的余额仍为1以太，因为第18行尚未执行。因此，我们仍然有 balances[0x0..123] = 1 Ether。lastWithdrawTime 变量也是如此。我们再次通过了所有要求。</li>
<li>EtherStore.sol - 第17行- 我们提取另外1个以太币。</li>
<li>步骤4-8将重复- 直到 EtherStore.balance&lt;= 1，如 Attack.sol 中的第26行所示。</li>
<li>Attack.sol - 第26行 - 一旦 EtherStore 合约中剩下不多于1（或更少）的ether，则此if语句将失败。然后，这将允许执行 EtherStore 合约的第18和19行（对于withdrawFunds()函数的每次调用）。</li>
<li>EtherStore.sol – 第18和19行- 将设置 balances 和 lastWithdrawTime 映射，执行将结束。</li>
</ol>
<p>最终的结果是，攻击者只用一笔交易，便立即从 EtherStore 合约中取出了（除去 1 个 Ether 以外）所有的 Ether。</p>
<h2 id="0x04-预防"><a href="#0x04-预防" class="headerlink" title="0x04 预防"></a>0x04 预防</h2><ul>
<li><p>在发送ether时使用内置的<code>transfer()</code>函数(仅使用2300gas，不足以call其他合约)</p>
</li>
<li><p>确保所有更改状态变量的逻辑都在以太币被发送出合同（或任何外部调用）之前发生。</p>
<p>​    比如在<code>EtherStore</code>示例中，第[18]和[19]行<code>EtherStore.sol</code>应放在第[17]行之前</p>
</li>
<li><p>引入互斥锁。也就是说，添加一个状态变量，在代码执行期间锁定合约，防止重入调用。</p>
</li>
</ul>
<p>将所有这些技术（这三项都是不必要的，但都是出于说明目的）应用于<code>EtherStore.sol</code>，可以得到无重入合同：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">contract EtherStore &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// initialise the mutex</span></span><br><span class="line">    bool reEntrancyMutex = <span class="literal">false</span>;</span><br><span class="line">    uint256 public withdrawalLimit = <span class="number">1</span> ether;</span><br><span class="line">    mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint256) public lastWithdrawTime;</span><br><span class="line">    mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint256) public balances;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">depositFunds</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">payable</span> </span>&#123;</span><br><span class="line">        balances[msg.sender] += msg.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">withdrawFunds</span> (<span class="params">uint256 _weiToWithdraw</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(!reEntrancyMutex);</span><br><span class="line">        <span class="built_in">require</span>(balances[msg.sender] &gt;= _weiToWithdraw);</span><br><span class="line">        <span class="comment">// limit the withdrawal</span></span><br><span class="line">        <span class="built_in">require</span>(_weiToWithdraw &lt;= withdrawalLimit);</span><br><span class="line">        <span class="comment">// limit the time allowed to withdraw</span></span><br><span class="line">        <span class="built_in">require</span>(now &gt;= lastWithdrawTime[msg.sender] + <span class="number">1</span> weeks);</span><br><span class="line">        balances[msg.sender] -= _weiToWithdraw;</span><br><span class="line">        lastWithdrawTime[msg.sender] = now;</span><br><span class="line">        <span class="comment">// set the reEntrancy mutex before the external call</span></span><br><span class="line">        reEntrancyMutex = <span class="literal">true</span>;</span><br><span class="line">        msg.sender.transfer(_weiToWithdraw);</span><br><span class="line">        <span class="comment">// release the mutex after the external call</span></span><br><span class="line">        reEntrancyMutex = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h2 id="0x05-Refer"><a href="#0x05-Refer" class="headerlink" title="0x05 Refer"></a>0x05 Refer</h2><p><a target="_blank" rel="noopener" href="https://solidity.readthedocs.io/en/v0.6.3/contracts.html#fallback-function">https://solidity.readthedocs.io/en/v0.6.3/contracts.html#fallback-function</a></p>
<p><a target="_blank" rel="noopener" href="https://solidity.tryblockchain.org/14825685263030.html">https://solidity.tryblockchain.org/14825685263030.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.sigmaprime.io/solidity-security.html#re-vuln">https://blog.sigmaprime.io/solidity-security.html#re-vuln</a></p>
<p><a target="_blank" rel="noopener" href="https://lalajun.github.io/2018/08/29/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%AE%89%E5%85%A8-%E9%87%8D%E5%85%A5%E6%94%BB%E5%87%BB/">https://lalajun.github.io/2018/08/29/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%AE%89%E5%85%A8-%E9%87%8D%E5%85%A5%E6%94%BB%E5%87%BB/</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1413221">https://cloud.tencent.com/developer/article/1413221</a></p>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/601/#3-fallback">https://paper.seebug.org/601/#3-fallback</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://lyuane.github.io/2020/01/30/2020-01-30-java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="沄渊">
      <meta itemprop="description" content="路漫漫其修远兮,吾将上下而求索">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沄渊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/30/2020-01-30-java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">Java多线程基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-30 00:00:00" itemprop="dateCreated datePublished" datetime="2020-01-30T00:00:00+08:00">2020-01-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="0x01-基本概念"><a href="#0x01-基本概念" class="headerlink" title="0x01 基本概念"></a>0x01 基本概念</h2><h3 id="1-1-程序、进程、线程"><a href="#1-1-程序、进程、线程" class="headerlink" title="1.1 程序、进程、线程"></a>1.1 程序、进程、线程</h3><p>程序：是为完成特定任务，用某种语言编写的一组指令的集合，即指一段静态的代码。<br>进程：是程序的一次执行过程，或是正在运行的一个程序，是一个动态的过程，有它自身的产生，存在和消亡的过程。进程是系统进行资源分配和调度的基本单位。<br>线程：进程可进一步细化为线程，一个进程中可以并发多个线程，每条线程并行执行不同的任务。线程是操作系统能够进行调度的最小单位。</p>
<h3 id="1-2-并行、并发"><a href="#1-2-并行、并发" class="headerlink" title="1.2 并行、并发"></a>1.2 并行、并发</h3><p>并发（Concurrent），在操作系统中，是指一个时间段中有几个程序都处于已启动运行到运行完毕之间，且这几个程序都是在同一个处理机上运行。</p>
<p>并行（Parallel），当系统有一个以上CPU时，当一个CPU执行一个进程时，另一个CPU可以执行另一个进程，两个进程互不抢占CPU资源，可以同时进行，这种方式我们称之为并行(Parallel)。</p>
<p><strong>所以，并发是在一段时间内宏观上多个程序同时运行，并行是在某一时刻，真正有多个程序在运行。</strong></p>
<h3 id="1-3-线程相关API"><a href="#1-3-线程相关API" class="headerlink" title="1.3 线程相关API"></a>1.3 线程相关API</h3><ul>
<li>start()：启动当前线程，调用当前线程的run()</li>
<li>run()：通常需要重写Thread类中的此方法，将创建的线程要执行的操作声明在此方法中</li>
<li>currentThread()：静态方法，返回当前执行代码的线程</li>
<li>getName():获取当前线程的名字</li>
<li>setName()：设置当前线程的名字</li>
<li>isALive()：判断当前线程是否存活</li>
</ul>
<h2 id="0x02-线程的生命周期"><a href="#0x02-线程的生命周期" class="headerlink" title="0x02 线程的生命周期"></a>0x02 线程的生命周期</h2><p><img src="https://img2018.cnblogs.com/blog/1257924/201903/1257924-20190321194234407-1337542647.png" alt="img"></p>
<p>现代操作系统中，线程共分为如上图五种状态，其中最常见的为就绪态、运行态、阻塞态。</p>
<table>
<thead>
<tr>
<th>线程生命周期的阶段</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>新建</td>
<td>当一个Thread类或其子类的对象被声明并创建时，新生的线程对象处于新建状态</td>
</tr>
<tr>
<td>就绪</td>
<td>处于新建状态的线程被start后，将进入线程队列等待CPU时间片，此时它已具备了运行的条件，只是没分配到CPU资源</td>
</tr>
<tr>
<td>运行</td>
<td>当就绪的线程被调度并获得CPU资源时，便进入运行状态，run方法定义了线程的操作和功能</td>
</tr>
<tr>
<td>阻塞</td>
<td>在某种特殊情况下，被人为挂起或执行输入输出操作时，让出CPU并临时终止自己的执行，进入阻塞状态</td>
</tr>
<tr>
<td>死亡</td>
<td>线程完成了它的全部工作或线程被提前强制性地中止或出现异常导致结束</td>
</tr>
</tbody></table>
<p>在java.lang.Thread.State中(参考<a target="_blank" rel="noopener" href="https://www.baidu.com/link?url=r2IbuEss_qatfbLLfRVQ-kLVxcg949AMv6n_h7VJTVMIcS6Tn544ZFDwPvLyt5huzRoUU8SKug_9grGAZxnAp20A4AnlNzGp_7M34S6GVBq&wd=&eqid=f25ed651001bd5fc000000035e3c10b4"><em>Java</em> <em>Platform</em> SE 8</a>)，线程状态如下</p>
<blockquote>
<p>A thread state. A thread can be in one of the following states: </p>
<ul>
<li><a href="../../java/lang/Thread.State.html#NEW"><code>NEW</code></a><br>A  thread that has not yet started is in this state. </li>
<li><a href="../../java/lang/Thread.State.html#RUNNABLE"><code>RUNNABLE</code></a><br>A  thread executing in the Java virtual machine is in this state. </li>
<li><a href="../../java/lang/Thread.State.html#BLOCKED"><code>BLOCKED</code></a><br>A  thread that is blocked waiting for a monitor lock is in this state. </li>
<li><a href="../../java/lang/Thread.State.html#WAITING"><code>WAITING</code></a><br>A  thread that is waiting indefinitely for another thread to perform a particular  action is in this state. </li>
<li><a href="../../java/lang/Thread.State.html#TIMED_WAITING"><code>TIMED_WAITING</code></a><br>A  thread that is waiting for another thread to perform an action for up to a  specified waiting time is in this state. </li>
<li><a href="../../java/lang/Thread.State.html#TERMINATED"><code>TERMINATED</code></a><br>A  thread that has exited is in this state. </li>
</ul>
<p>A thread can be in only one state at a given point in time. These states are  virtual machine states which do not reflect any operating system thread states.</p>
</blockquote>
<h2 id="0x03-创建线程"><a href="#0x03-创建线程" class="headerlink" title="0x03 创建线程"></a>0x03 创建线程</h2><p>参照java.lang.Thread，在java中创建线程主要由两种方式</p>
<blockquote>
<p>There are two ways to create a new thread of execution. One is to declare a  class to be <strong>a subclass of <code>Thread</code></strong>. This subclass should override the  <code>run</code> method of class <code>Thread</code>. An instance of the  subclass can then be allocated and started. ······The other way to create a thread is to <strong>declare a class that implements the  <code>Runnable</code> interface</strong>. That class then implements the <code>run</code>  method. An instance of the class can then be allocated, passed as an argument  when creating <code>Thread</code>, and started. </p>
</blockquote>
<h3 id="2-1-继承Thread类"><a href="#2-1-继承Thread类" class="headerlink" title="2.1 继承Thread类"></a>2.1 继承Thread类</h3><ol>
<li>创建一个继承于Thread类的子类</li>
<li>重写Thread类的run()–&gt;将此线程执行的操作声明在run()中</li>
<li>创建Thread类的子类的对象</li>
<li>通过此对象调用start</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建一个继承于Thread类的子类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="comment">//2.重写Thread类的run()</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//执行的操作声明，比如输出1--100</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)&#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//3.创建Thread类的子类的对象</span></span><br><span class="line">        MyThreaad t1 = <span class="keyword">new</span> MyThread();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//4.通过此对象调用start()</span></span><br><span class="line">        t1.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-2-实现Runnable接口"><a href="#2-2-实现Runnable接口" class="headerlink" title="2.2 实现Runnable接口"></a>2.2 实现Runnable接口</h3><ol>
<li>创建一个实现了Runnable接口的类</li>
<li>实现类去实现Runnable中的抽象方法：run()</li>
<li>创建实现类的对象</li>
<li>将此对象作为参数传递到Thread类的构造器中，创建Thread类的对象</li>
<li>通过Thread类的对象调用start()</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建一个实现了Runnable接口的类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="comment">//2.实现类去实现Runnable中的抽象方法：run()</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 执行的操作，比如输出1--100</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)&#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest1</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//3.创建实现类的对象</span></span><br><span class="line">        MThread mThread = <span class="keyword">new</span> Mthread();</span><br><span class="line">        <span class="comment">//4.将此对象作为参数传递到Thread类的构造器中，创建Thread类的对象</span></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(mThread);</span><br><span class="line">        <span class="comment">//5.通过Thread类的对象调用start()</span></span><br><span class="line">        t1.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>建议使用***实现Runable接口***方式</p>
<ul>
<li>实现的方式解决了类的单继承性的局限性</li>
<li>实现的方式更适合来处理多个线程有共享数据的情况。</li>
</ul>
<h3 id="2-3-新增的两种方式"><a href="#2-3-新增的两种方式" class="headerlink" title="2.3 新增的两种方式"></a>2.3 新增的两种方式</h3><p>实现callable接口方式、使用线程池的方式</p>
<h2 id="0x04-线程状态"><a href="#0x04-线程状态" class="headerlink" title="0x04 线程状态"></a>0x04 线程状态</h2><h3 id="4-1-线程睡眠"><a href="#4-1-线程睡眠" class="headerlink" title="4.1 线程睡眠"></a>4.1 线程睡眠</h3><p><code>sleep(long millis)</code>   在指定的毫秒数内让正在执行的线程休眠</p>
<blockquote>
<p>Causes the currently executing thread to sleep (temporarily  cease execution) for the specified number of milliseconds, subject to the  precision and accuracy of system timers and schedulers.</p>
</blockquote>
<h3 id="4-2-线程让步"><a href="#4-2-线程让步" class="headerlink" title="4.2 线程让步"></a>4.2 线程让步</h3><p><code>yield()</code>   让正在执行的线程暂停，但是不会进入阻塞状态，而是直接进入就绪状态。</p>
<blockquote>
<p>A hint to the scheduler that the current thread is willing to  yield its current use of a processor.</p>
</blockquote>
<h3 id="4-3-线程加入"><a href="#4-3-线程加入" class="headerlink" title="4.3 线程加入"></a>4.3 线程加入</h3><p><code>join()</code>   当B线程执行到了A线程的.join（）方法时，B线程就会等待，等A线程都执行完毕，B线程才会执行。</p>
<blockquote>
<p>Waits for this thread to die.</p>
</blockquote>
<h3 id="4-4-线程停止"><a href="#4-4-线程停止" class="headerlink" title="4.4 线程停止"></a>4.4 线程停止</h3><p>终止正在运行的线程方法有三种：<br>  <strong>1)使用退出标志,使线程正常的执行完run方法终止。</strong><br>  <strong>2)使用interrupt方法,使线程异常，线程进行捕获或抛异常，正常执行完run方法终止。</strong><br>  <strong><del>3)使用stop方法强制退出。</del></strong></p>
<h3 id="4-5-设置优先级"><a href="#4-5-设置优先级" class="headerlink" title="4.5 设置优先级"></a>4.5 设置优先级</h3><p>Java线程优先级分为1–10，提供了三个默认参数:<code>MAX_PRIORITY=10、MIN_PRIORITY=1、NORM_PRIORITY=5</code></p>
<ul>
<li>线程优先级具有继承特性， 比如A线程启动B线程，则B线程的优先级与A是一样的。</li>
<li>优先级具有规则性，虽然我们使用<code>setPriority()</code>方法设置了优先级，但是真正执行的过程中，不会保证优先级高的线程绝对比优先级低的线程优先完成。即<strong>CPU尽量将执行资源让给优先级比较高的线程</strong>。</li>
<li>优先级具有随机性，具优先级较高的线程不一定每一次都先执行完。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getPriority()<span class="comment">//得到当前线程的优先级</span></span><br><span class="line"></span><br><span class="line">setPriority(<span class="keyword">int</span>  p)<span class="comment">//为当前线程设置优先级</span></span><br></pre></td></tr></table></figure>

<h3 id="4-6-守护线程"><a href="#4-6-守护线程" class="headerlink" title="4.6 守护线程"></a>4.6 守护线程</h3><ul>
<li>在Java线程中有两种线程，一种是<code>用户线程</code>，另一种是<code>守护线程</code>。</li>
</ul>
<blockquote>
<p>守护线程是一种特殊的线程，它的特性有“陪伴”的含义，当进程中不存在非守护线程了，则守护线程自动销毁。<br> 典型的守护线程就是垃圾回收线程，当进程中没有非守护线程了，则垃圾回收线程则没有存在的必要了，自动销毁。<br> 只要当前JVM实例中存在任何一个非守护线程没有结束，守护线程就在工作，只有当最后一个非守护线程结束时，守护线程才随着JVM一同结束工作。<br> 通过调用<code>Thread.setDaemon(true)</code>设置是否为守护线程。</p>
</blockquote>
<h2 id="0x05-线程同步"><a href="#0x05-线程同步" class="headerlink" title="0x05 线程同步"></a>0x05 线程同步</h2><p>0x06 线程通信</p>
<p>0x07 线程池</p>
<h2 id="0x06-Refer"><a href="#0x06-Refer" class="headerlink" title="0x06 Refer"></a>0x06 Refer</h2><p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/?java/util/Collection.html">https://docs.oracle.com/javase/8/docs/api/?java/util/Collection.html</a></p>
<p><a target="_blank" rel="noopener" href="https://book.douban.com/subject/27096665/">https://book.douban.com/subject/27096665/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d901b25e0d4a">https://www.jianshu.com/p/d901b25e0d4a</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ccb91e3444d9">https://www.jianshu.com/p/ccb91e3444d9</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44797490/article/details/91006241">https://blog.csdn.net/weixin_44797490/article/details/91006241</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://lyuane.github.io/2020/01/21/2020-01-21-%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E8%AE%BE%E8%AE%A1-%E5%91%98%E5%B7%A5%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="沄渊">
      <meta itemprop="description" content="路漫漫其修远兮,吾将上下而求索">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沄渊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/21/2020-01-21-%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E8%AE%BE%E8%AE%A1-%E5%91%98%E5%B7%A5%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">智能合约设计-员工系统</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-21 00:00:00" itemprop="dateCreated datePublished" datetime="2020-01-21T00:00:00+08:00">2020-01-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="0x00"><a href="#0x00" class="headerlink" title="0x00"></a>0x00</h2><p>参考课程：   <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av46756583?p=1">[区块链] 智能合约设计@Celer</a></p>
<h2 id="0x01-solidity初识"><a href="#0x01-solidity初识" class="headerlink" title="0x01 solidity初识"></a>0x01 solidity初识</h2><h3 id="1-1-代码简例"><a href="#1-1-代码简例" class="headerlink" title="1.1  代码简例"></a>1.1  代码简例</h3><p>做一个简单的例子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity <span class="number">0.4</span><span class="number">.23</span>;   <span class="comment">//程序版本</span></span><br><span class="line"></span><br><span class="line">contract Simple&#123;        <span class="comment">//合约声明</span></span><br><span class="line">    uint data;         <span class="comment">//状态变量</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">uint x</span>)</span>&#123;       <span class="comment">//合约方法</span></span><br><span class="line">        data = x;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"></span>) <span class="title">view</span> <span class="title">returns</span>(<span class="params">uint</span>)</span>&#123;   <span class="comment">// 早期版本的consstant 现在的view 修饰函数时视觉上的警示，不会报错，只是一个建议；pure 更为严格，无读写权限   修饰变量时要求其不能更改      returns(unit) 表示返回的类型</span></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-在remix下尝试运行"><a href="#1-2-在remix下尝试运行" class="headerlink" title="1.2  在remix下尝试运行"></a>1.2  在remix下尝试运行</h3><p>设初值10，尝试运行set函数</p>
<p><img src="https://yuane.oss-cn-beijing.aliyuncs.com/img/2019/20200212115852.png"></p>
<p>运行get方法得到初值</p>
<p><img src="https://yuane.oss-cn-beijing.aliyuncs.com/img/2019/20200212115921.png"></p>
<h3 id="1-3-测试"><a href="#1-3-测试" class="headerlink" title="1.3 测试"></a>1.3 测试</h3><p>根据官方文档</p>
<blockquote>
<p><code>int</code> / <code>uint</code>: Signed and unsigned integers of various sizes. Keywords <code>uint8</code> to <code>uint256</code> in steps of <code>8</code> (unsigned of 8 up to 256 bits) and <code>int8</code> to <code>int256</code>. <code>uint</code> and <code>int</code> are aliases for <code>uint256</code> and <code>int256</code>, respectively.</p>
</blockquote>
<p>而无符号整型uint分为uint8、uint16、uint24 ……，8位一步，直到uint256</p>
<p>如果后面的数字省略，则默认为<strong>uint256</strong></p>
<p>这里为了方便测试，将源代码改为<code>uint8 data;</code></p>
<p>uint8代表可存储的数字范围为8位,即可存储 0 ~ 255 之间的数字。</p>
<h4 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h4><p>如下图，255运行正常</p>
<p><img src="https://yuane.oss-cn-beijing.aliyuncs.com/img/2019/20200212115946.png"></p>
<p>设置256运行错误，说明存在编译保护。</p>
<p><img src="https://yuane.oss-cn-beijing.aliyuncs.com/img/2019/20200212120003.png"></p>
<p><strong>根据存储需要去定义最合适的存储范围，可节约内存，提高程序运行速度。</strong></p>
<p>思考   类型转换呢？  参考计组</p>
<h2 id="0x02-solidity语法"><a href="#0x02-solidity语法" class="headerlink" title="0x02 solidity语法"></a>0x02 solidity语法</h2><h4 id="静态类型语言"><a href="#静态类型语言" class="headerlink" title="静态类型语言"></a>静态类型语言</h4><p>布尔型    true false ! &amp;&amp; || == !=</p>
<h4 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h4><p>int/uint  各种操作符  </p>
<p><strong>solidity 无浮点数</strong></p>
<h4 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h4><ul>
<li>address.balance    //查询账户余额</li>
<li>address.transfer(value)     //发送以太币  以wei为单位</li>
<li>address.send(value)</li>
<li>address.call address.callcode  address.delegatecall</li>
</ul>
<h4 id="ETHER-Units-货币单位"><a href="#ETHER-Units-货币单位" class="headerlink" title="ETHER Units   货币单位"></a>ETHER Units   货币单位</h4><ul>
<li>wei</li>
<li>szabo = 10^12wei</li>
<li>finney = 10^15wei</li>
<li>ether = 10^18wei</li>
<li>不含任何后缀的默认单位是<code>wei</code></li>
</ul>
<h4 id="Time-Units-时间单位"><a href="#Time-Units-时间单位" class="headerlink" title="Time Units 时间单位"></a>Time Units 时间单位</h4><ul>
<li>seconds</li>
<li>minutes</li>
<li>hours</li>
<li>days</li>
<li>weeks</li>
<li>years</li>
</ul>
<p>如果需要进行使用这些单位进行日期计算，需要特别小心，因为不是每年都是365天，且并不是每天都有24小时，因为还有闰秒。由于无法预测闰秒，必须由外部的oracle来更新从而得到一个精确的日历库（内部实现一个日期库也是消耗gas的）。</p>
<h4 id="块"><a href="#块" class="headerlink" title="块"></a>块</h4><ul>
<li><p>block.blockhash(uint blockNumber) returns (bytes32)<br>传进去一个blockNumber，则返回一个该block目前的hash（哈希）是什么  该哈希的长度为32位</p>
</li>
<li><p>block.coinbase(address)<br>这个函数是指谁挖到了该bloc</p>
</li>
<li><p>block.difficulity(uint)</p>
</li>
<li><p>block.gaslimit(uint)<br>该block总的最多的gas是多少</p>
</li>
<li><p>block.number(uint)<br>该block是第几个块</p>
</li>
<li><p>block.timestamp(uint)<br>该block目前创建的时间</p>
</li>
</ul>
<h4 id="消息"><a href="#消息" class="headerlink" title="消息"></a>消息</h4><p>消息的作用：当它在执行某一个智能合约的函数的时候，这个函数的内部想要知道一些调用函数的人或者数据的信息时，这个时候就需要从msg中获取到</p>
<ul>
<li>msg.data<br>包含了整个调用的函数的名字或者函数的信息</li>
<li>msg.gas(uint)<br>获取调用函数的人附带了多少gas到这个函数调用的call里</li>
<li>msg.sender(address)<br>获取谁调用了这个函数</li>
<li>msg.sig</li>
<li>msg.value(uit)<br>它代表的这个msg中带着多少钱，以wei为单位</li>
</ul>
<h2 id="0x03-员工系统设计实现-单人"><a href="#0x03-员工系统设计实现-单人" class="headerlink" title="0x03 员工系统设计实现(单人)"></a>0x03 员工系统设计实现(单人)</h2><h3 id="3-1-需要考虑的问题"><a href="#3-1-需要考虑的问题" class="headerlink" title="3.1 需要考虑的问题"></a>3.1 需要考虑的问题</h3><p>被动调用的函数执行模式</p>
<blockquote>
<p>定时器？  否，被动调用</p>
<p>老董每月通过合约给frank打钱？</p>
<p>如何防止老董拖欠frank工资？</p>
<p>智能合约可作为可信中介，在合约上存钱，frank再每30天领取</p>
</blockquote>
<h3 id="3-2-设计"><a href="#3-2-设计" class="headerlink" title="3.2 设计"></a>3.2 设计</h3><ul>
<li><p>薪水全部基于以太币   </p>
<ul>
<li>unit salary; //薪水</li>
<li>address frank; //员工</li>
</ul>
</li>
<li><p>每周期发一次</p>
<ul>
<li>uint payDuration; //周期</li>
<li>uint lastPayday; //上次支付日期</li>
</ul>
</li>
<li><p>方法</p>
<ul>
<li>function addFund    </li>
<li>function calculateRunway</li>
<li>function hasEnoughFund</li>
<li>function getPaid</li>
</ul>
</li>
</ul>
<h3 id="3-3-代码实现"><a href="#3-3-代码实现" class="headerlink" title="3.3 代码实现"></a>3.3 代码实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.14</span>;</span><br><span class="line"></span><br><span class="line">contract payRoll&#123;</span><br><span class="line">    uint salary = <span class="number">1</span> ether;</span><br><span class="line">    address frank = <span class="number">0xCA35b7d915458EF540aDe6068dFe2F44E8fa733c</span>; <span class="comment">//固定地址，硬编码</span></span><br><span class="line">    uint payDuration = <span class="number">30</span> days;</span><br><span class="line">    uint lastPayday = now;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">addFund</span>(<span class="params"></span>) <span class="title">payable</span> <span class="title">returns</span> (<span class="params">uint</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.balance;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">calculatRunway</span>(<span class="params"></span>) <span class="title">returns</span> (<span class="params">uint</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.balance / salary ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">hasEnoughFund</span>(<span class="params"></span>) <span class="title">returns</span>(<span class="params">bool</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.balance &gt;= salary ;</span><br><span class="line">        <span class="comment">// return this.calculatRunway() &gt; 0 ;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getPaid</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//确保发送人为frank</span></span><br><span class="line">        <span class="keyword">if</span>(msg.sender != frank)&#123;</span><br><span class="line">            revert();</span><br><span class="line">        &#125; </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//注意局部变量作用域 与js类似  不同于java</span></span><br><span class="line">        uint nextPayDay = lastPayday + payDuration;</span><br><span class="line">        <span class="keyword">if</span>(nextPayDay &gt; now)&#123;</span><br><span class="line">            revert();<span class="comment">//回滚代码  交还剩余gas</span></span><br><span class="line">        &#125;</span><br><span class="line">        lastPayday = nextPayDay;</span><br><span class="line">        frank.transfer(salary);  <span class="comment">// 一定要修改完变量再给钱</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="0x04-员工系统设计实现-多人"><a href="#0x04-员工系统设计实现-多人" class="headerlink" title="0x04 员工系统设计实现(多人)"></a>0x04 员工系统设计实现(多人)</h2><h3 id="4-1-错误检测"><a href="#4-1-错误检测" class="headerlink" title="4.1 错误检测"></a>4.1 错误检测</h3><p>require   要求用户输入的值满足一定要求</p>
<p>assert    程序运行过程中确认</p>
<h3 id="4-2-数组"><a href="#4-2-数组" class="headerlink" title="4.2 数组"></a>4.2 数组</h3><p>固定数组/动态数组   length push</p>
<p>for  delete用法</p>
<p>辅助function  可见度</p>
<h3 id="4-3-数据存储"><a href="#4-3-数据存储" class="headerlink" title="4.3 数据存储"></a>4.3 <strong>数据存储</strong></h3><ul>
<li>storage     存储在区块链上的永久空间，不会被抹去</li>
<li>memory    EVM中临时的空间   运行完后释放</li>
<li>calldata   类似于memory</li>
<li>强制类型<ul>
<li>状态变量：storage</li>
<li>function输入参数 calldata</li>
</ul>
</li>
<li>默认类型<ul>
<li>function返回参数：memory</li>
<li>本地变量：storage</li>
</ul>
</li>
</ul>
<p>变量的本质是指向EVM中的一块内存区域</p>
<ul>
<li>相同的存储空间变量赋值<ul>
<li>传递reference（EVM上的内存地址）</li>
</ul>
</li>
<li>不同存储空间变量赋值<ul>
<li>拷贝</li>
</ul>
</li>
</ul>
<h3 id="4-4-代码实现"><a href="#4-4-代码实现" class="headerlink" title="4.4 代码实现"></a>4.4 代码实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.23</span>;</span><br><span class="line"></span><br><span class="line">contract Payroll&#123;</span><br><span class="line">    struct Employee&#123;</span><br><span class="line">        address id;</span><br><span class="line">        uint salary;</span><br><span class="line">        uint lastPayday;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">   uint constant payDuration = <span class="number">10</span> seconds;<span class="comment">//方便测试</span></span><br><span class="line">   </span><br><span class="line">   address owner;</span><br><span class="line">   Employee[] employees;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Payroll</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    owner = msg.sender;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_partialPaid</span>(<span class="params">Employee employee</span>) <span class="title">private</span></span>&#123;</span><br><span class="line">            uint payment = employee.salary * (now - employee.lastPayday) /payDuration;<span class="comment">//整除，不存在浮点数</span></span><br><span class="line">            employee.id.transfer(payment);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_findEmloyee</span>(<span class="params">address employeeId</span>) <span class="title">private</span> <span class="title">returns</span> (<span class="params">Employee,uint</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (uint i=<span class="number">0</span>;i&lt;employees.length;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (employees[i].id == employeeId)&#123;</span><br><span class="line">                <span class="keyword">return</span> (employees[i],i);</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">addEmployee</span>(<span class="params">address employeeId,uint salary</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.sender == owner);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> (employee,index ) = _findEmloyee(employeeId); <span class="comment">//var 任意类型</span></span><br><span class="line">        assert(employee.id != <span class="number">0x0</span>);   <span class="comment">//如果不存在 地址即为0x0</span></span><br><span class="line">        </span><br><span class="line">        employees.push(Employee(employeeId,salary,now));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">removeEmployee</span>(<span class="params">address employeeId</span>)</span>&#123;</span><br><span class="line">         <span class="built_in">require</span>(msg.sender == owner);</span><br><span class="line">         <span class="keyword">var</span> (employee,index) = _findEmloyee(employeeId); </span><br><span class="line">         assert(employee.id != <span class="number">0x0</span>);</span><br><span class="line">        _partialPaid(employees[index]);</span><br><span class="line">        <span class="keyword">delete</span> employees[index];</span><br><span class="line">        employees[index] = employees[employees.length - <span class="number">1</span>];</span><br><span class="line">        employees.length -= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">updateEmployee</span>(<span class="params">address employeeId,uint salary</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.sender == owner);</span><br><span class="line">        <span class="comment">//等效 </span></span><br><span class="line">        <span class="comment">// if (msg.sender != owner)&#123;//avoid employee cheating</span></span><br><span class="line">        <span class="comment">//     revert();</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        </span><br><span class="line">         <span class="keyword">var</span> (employee,index) = _findEmloyee(employeeId); </span><br><span class="line">         assert(employee.id != <span class="number">0x0</span>);</span><br><span class="line">        _partialPaid(employee);</span><br><span class="line">        employees[index].salary = salary;</span><br><span class="line">        employees[index].lastPayday = now;     </span><br><span class="line">         </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">addFund</span>(<span class="params"></span>) <span class="title">payable</span> <span class="title">returns</span>(<span class="params">uint</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.balance;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">calculateRunway</span>(<span class="params"></span>)<span class="title">returns</span>(<span class="params">uint</span>)</span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">        uint totalSalary = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (uint i=<span class="number">0</span>;i&lt;employees.length;i++)</span><br><span class="line">         &#123;</span><br><span class="line">             totalSalary += employees[i].salary; </span><br><span class="line">         &#125; </span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.balance / totalSalary; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">hasEnoughFund</span>(<span class="params"></span>) <span class="title">returns</span>(<span class="params">bool</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// return this.balance &gt;=salary;</span></span><br><span class="line">        <span class="comment">//return this.calculateRunway() &gt; 0; //this方法 使用的gas 较多，不推荐</span></span><br><span class="line">        <span class="comment">//因为this会将其看为外部函数进行引用</span></span><br><span class="line">        <span class="keyword">return</span> calculateRunway() &gt; <span class="number">0</span>; <span class="comment">//vm jump 操作,使用gas较少,推荐</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getPaid</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">         <span class="keyword">var</span> (employee,index) = _findEmloyee(msg.sender); </span><br><span class="line">         assert(employee.id != <span class="number">0x0</span>);</span><br><span class="line">        uint nextPayday = employee.lastPayday + payDuration;</span><br><span class="line">         <span class="comment">//每一次运算都是真金白银~</span></span><br><span class="line">         <span class="comment">//原则：不重复运算！——省gas</span></span><br><span class="line">        assert(nextPayday &lt; now);</span><br><span class="line">        <span class="comment">// if( nextPayday &gt; now)&#123;</span></span><br><span class="line">        <span class="comment">//     revert();</span></span><br><span class="line">              <span class="comment">//throw or revert</span></span><br><span class="line">            <span class="comment">//throw: 所有的gas 均会被消耗殆尽</span></span><br><span class="line">            <span class="comment">//revert：回滚，return没有消耗的gas</span></span><br><span class="line">           </span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        </span><br><span class="line">            employees[index].lastPayday = nextPayday;<span class="comment">//原则：先修改内部变量，再给钱——》之后会讲，安全问题</span></span><br><span class="line">            employee.id.transfer(employee.salary);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="0x05-优化"><a href="#0x05-优化" class="headerlink" title="0x05  优化"></a>0x05  优化</h2><h3 id="5-1-mapping"><a href="#5-1-mapping" class="headerlink" title="5.1 mapping"></a>5.1 mapping</h3><p>在不断添加员工时，由于遍历数组导致gas消耗增加,使用mapping可以避免遍历数组</p>
<p>mapping   </p>
<ul>
<li>类似于hash表</li>
<li>key(bool,int ,address, string)</li>
<li>value(任何类型)</li>
<li>mapping(_KeyType =&gt; _KeyValue)</li>
<li>只能做成员变量，不能做本地局部变量</li>
</ul>
<p>关于mapping的底层实现</p>
<ul>
<li>不使用数组+链表，不需要扩容</li>
<li>hash函数为keccak256hash（keccak 即SHA- 3）</li>
<li>在storage 上存储，理论上为无限大的hash表<br>无法naive地遍历整个mapping</li>
<li>赋值 employees[key] = value</li>
<li>取值 value = employees[key]</li>
<li>value 是引用，在storage上存储，可以直接修改</li>
<li>当key 不存在，value = type’s default // 不会抛出异常</li>
</ul>
<h3 id="5-2-函数返回"><a href="#5-2-函数返回" class="headerlink" title="5.2 函数返回"></a>5.2 函数返回</h3><ul>
<li>命名参数返回</li>
<li>命名返回参数直接赋值</li>
</ul>
<h3 id="5-3-可视度"><a href="#5-3-可视度" class="headerlink" title="5.3 可视度"></a>5.3 可视度</h3><p>solidity共有四种可视度</p>
<ul>
<li>public：谁都可见；</li>
<li>external：只有“外部调用者”可见；</li>
<li>internal：外部调用不可见，内部和子类可见；</li>
<li>private：只有当前合约可见。</li>
</ul>
<h5 id="可视度修饰变量"><a href="#可视度修饰变量" class="headerlink" title="可视度修饰变量"></a>可视度修饰变量</h5><p>可以修饰状态变量的可视度有：public 、internal、private<br>状态变量的默认可视度为：internal<br>public修饰变量：自动定义取值函数！<br>private修饰变量：它不代表别人无法用肉眼看淡，它只代表别的区块链智能合约无法看到！</p>
<blockquote>
<p>为什么没有external呢？因为用它修饰的变量只能外部合约访问，而如果一个变量只能外部合约访问那它在本合约中定义就没有任何意义了，所以external是不能修饰状态变量的。</p>
</blockquote>
<h5 id="可视度修饰函数"><a href="#可视度修饰函数" class="headerlink" title="可视度修饰函数"></a>可视度修饰函数</h5><p>可以修饰函数的可视度有：public、external、internal、private<br>函数的默认可视度为：public</p>
<p>继承、多继承   感觉视频讲的很浅，有待进一步学习，看看文档</p>
<h2 id="0x06-安全"><a href="#0x06-安全" class="headerlink" title="0x06 安全"></a>0x06 安全</h2><ul>
<li>外部函数调用安全性<ul>
<li>eg: re-entry ,DAO attack ,150M loss </li>
</ul>
</li>
<li>函数可见性<ul>
<li>eg：parity wallet hack june ,2017</li>
</ul>
</li>
<li>数学运算安全<ul>
<li>整型溢出</li>
</ul>
</li>
<li>“随机数”与系统时间依赖性</li>
<li>合约数据可见性</li>
</ul>
<h2 id="0x07-Refer"><a href="#0x07-Refer" class="headerlink" title="0x07 Refer"></a>0x07 Refer</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av46756583?p=1">https://www.bilibili.com/video/av46756583?p=1</a></p>
<p><a target="_blank" rel="noopener" href="https://solidity.tryblockchain.org/">https://solidity.tryblockchain.org/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neo007/p/9166482.html">https://www.cnblogs.com/Neo007/p/9166482.html</a></p>
<p><a target="_blank" rel="noopener" href="https://bihu.com/article/1227601">https://bihu.com/article/1227601</a></p>
<p><a target="_blank" rel="noopener" href="https://learnblockchain.cn/2018/01/11/guide/">https://learnblockchain.cn/2018/01/11/guide/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://lyuane.github.io/2020/01/09/2020-01-09-truffle%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="沄渊">
      <meta itemprop="description" content="路漫漫其修远兮,吾将上下而求索">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沄渊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/09/2020-01-09-truffle%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">truffle入门</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-09 00:00:00" itemprop="dateCreated datePublished" datetime="2020-01-09T00:00:00+08:00">2020-01-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="0x00-了解truffle"><a href="#0x00-了解truffle" class="headerlink" title="0x00 了解truffle"></a>0x00 了解truffle</h2><p>Truffle 是一个开发工具体系, 用于以太坊平台的开发测试。它是当前以太坊最流行的开发框架，能够在本地编译、部署智能合约，使得智能合约的开发更容易。</p>
<h2 id="0x01-安装truffle"><a href="#0x01-安装truffle" class="headerlink" title="0x01 安装truffle"></a>0x01 安装truffle</h2><p>依赖：nodejs5.0+</p>
<p>安装truffle十分简单，借助npm命令<code>npm install -g truffle</code></p>
<p>同时Tunffle还要求一个运行的以太坊客户端，常见的有Ganache、geth等</p>
<h2 id="0x02-构建truffle项目"><a href="#0x02-构建truffle项目" class="headerlink" title="0x02 构建truffle项目"></a>0x02 构建truffle项目</h2><h3 id="2-1-创建目录"><a href="#2-1-创建目录" class="headerlink" title="2.1 创建目录"></a>2.1 创建目录</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir MetaCoin</span><br><span class="line">cd MetaCoin</span><br></pre></td></tr></table></figure>

<h3 id="2-2-下载样例"><a href="#2-2-下载样例" class="headerlink" title="2.2 下载样例"></a>2.2 下载样例</h3><p>下载MetaCoin box</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">truffle unbox metacoin</span><br><span class="line">//使用truffle unbox &lt;box-name&gt;来下载各种示例</span><br></pre></td></tr></table></figure>

<p>如果要建一个空的不包括智能合约的项目可以使用<code>truffle init</code></p>
<p>上述命令完成后，我们获得一个有以下目录结构的项目：</p>
<ul>
<li>contracts/： Solidity编写的智能合约目录。</li>
<li>migrations/：脚本部署目录。</li>
<li>test/：用来测试应用程序和智能合约的测试目录。</li>
<li>truffle.js/：Truffle 配置文件。</li>
</ul>
<h2 id="0x03-浏览项目结构"><a href="#0x03-浏览项目结构" class="headerlink" title="0x03 浏览项目结构"></a>0x03 浏览项目结构</h2><ol>
<li>打开<code>contracts/MetaCoin.sol</code>，这是一个用Solidity编写的智能合约文件，这个智能合约建了Metacoin代币，我们可以注意到它引用了同目录下的另外一个solidity编写的文件<code>contracts/ConvertLib.sol</code>。</li>
<li>打开<code>contracts/Migrations.sol</code>,这是一个单独的Solidity文件，用来管理和更新部署的智能合同的状态。这个文件每个Tunffle项目都有，通常不用管。</li>
<li>打开<code>migrations/1_initial_deployment.js</code>文件，这个脚本是为了部署<code>Migrations.sol</code>文件中的<code>Migrations</code>合约。</li>
<li>打开<code>migrations/2_deploy_contracts.js</code>文件，这个脚本是为了部署<code>MetaCoin</code>合约，会按顺序执行完上一步的脚本后执行。</li>
<li>打开<code>test/TestMetacoin.sol</code>文件，这是一个Solidity编写的测试文件，确保你的合约正常工作。</li>
<li>打开<code>test/metacoin.js</code>文件，这个脚本与上面的测试文件类似。</li>
<li>打开<code>truffle.js</code>文件，用于设置网络信息和其他与项目相关的内容。文件是空白的，没关系，因为我们将使用一个内置有默认值的Truffle命令。</li>
</ol>
<h2 id="0x04-编译部署"><a href="#0x04-编译部署" class="headerlink" title="0x04 编译部署"></a>0x04 编译部署</h2><p>以metacoin为例，对其进行编译和运行</p>
<p><code>truffle compile</code>编译产生的工作文件存储在./build/contracts/ </p>
<p><code>truffle migrate</code> 会运行 <code>migrations/</code> 文件夹下全部的合约脚本</p>
<p><img src="https://yuane.oss-cn-beijing.aliyuncs.com/img/2019/20200223173920.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://lyuane.github.io/2019/10/13/2019-10-13-%E5%AF%B9%E5%AF%86%E7%A0%81%E5%AD%A6%E7%BD%91%E7%AB%99%E7%9A%84%E6%B8%97%E9%80%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="沄渊">
      <meta itemprop="description" content="路漫漫其修远兮,吾将上下而求索">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沄渊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/10/13/2019-10-13-%E5%AF%B9%E5%AF%86%E7%A0%81%E5%AD%A6%E7%BD%91%E7%AB%99%E7%9A%84%E6%B8%97%E9%80%8F/" class="post-title-link" itemprop="url">对密码学网站的渗透</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-10-13 00:00:00" itemprop="dateCreated datePublished" datetime="2019-10-13T00:00:00+08:00">2019-10-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="0x01-查看源码"><a href="#0x01-查看源码" class="headerlink" title="0x01 查看源码"></a>0x01 查看源码</h3><p>进入主页</p>
<p><img src="https://yuane.oss-cn-beijing.aliyuncs.com/img/2019/20190708233931.png"></p>
<p>查看源码 看到footer下面有注册模块  但是主页面上并没有显示  感觉很奇怪</p>
<p><img src="https://yuane.oss-cn-beijing.aliyuncs.com/img/2019/1559612100110.png"></p>
<p>同时又看到登录按钮</p>
<p><img src="https://yuane.oss-cn-beijing.aliyuncs.com/img/2019/1559612345981.png"></p>
<h3 id="0x02-攻击尝试"><a href="#0x02-攻击尝试" class="headerlink" title="0x02  攻击尝试"></a>0x02  攻击尝试</h3><p>目的肯定是将注册功能启用，方法很多种</p>
<p>这里我直接将登录的按钮改成注册</p>
<p><img src="https://yuane.oss-cn-beijing.aliyuncs.com/img/2019/20190708234710.png"></p>
<p>注册老师账号并登录</p>
<p><img src="https://yuane.oss-cn-beijing.aliyuncs.com/img/2019/1559612474484.png"></p>
<p>进入老师管理界面</p>
<p><img src="https://yuane.oss-cn-beijing.aliyuncs.com/img/2019/1559612487737.png"></p>
<h3 id="0x03-获取权限"><a href="#0x03-获取权限" class="headerlink" title="0x03 获取权限"></a>0x03 获取权限</h3><p>因为有上传功能，这个时候想着寻找个路径</p>
<p>因为系统还在使用，不该随便动，所以先尝试下载文件</p>
<p><img src="https://yuane.oss-cn-beijing.aliyuncs.com/img/2019/20190708235132.png"></p>
<p>并没有得到有效信息</p>
<p>尝试访问./upload</p>
<p><img src="https://yuane.oss-cn-beijing.aliyuncs.com/img/2019/20190708235300.png"></p>
<p>发现一个路径   尝试访问一下，没有权限</p>
<p>这个时候尝试一下别的思路</p>
<p>上传文件（利用burp截包，并不会真正上传，毕竟学校的系统，不能随便来）</p>
<p>突然发现随便选个文件，还没有上传，系统自动将路径写在上面了</p>
<p>（我猜是开发人员对老师端比较信任，学生端不会出现）</p>
<p><img src="https://yuane.oss-cn-beijing.aliyuncs.com/img/2019/1559612910632.png"></p>
<p>因为没有文件检测，上传一句话木马</p>
<p>连接</p>
<p><img src="https://yuane.oss-cn-beijing.aliyuncs.com/img/2019/20190708235725.png"></p>
<h3 id="0x04-权限维持"><a href="#0x04-权限维持" class="headerlink" title="0x04  权限维持"></a>0x04  权限维持</h3><p>在服务器文件中加入了复杂的一句话木马,删除原来的木马</p>
<p>顺便对服务器做了点防护</p>
<p>也算是对学校做出的一点点微小的贡献</p>
<h3 id="0x05-后记"><a href="#0x05-后记" class="headerlink" title="0x05 后记"></a>0x05 后记</h3><p>在查看网站源码时发现一个很好玩的东西，有人在17年已经上传了个木马(说明之前已经被人搞过了)</p>
<p>可能已经被历届学长学姐搞过不知道多少回了</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://lyuane.github.io/2019/08/21/2019-08-21-%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="沄渊">
      <meta itemprop="description" content="路漫漫其修远兮,吾将上下而求索">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沄渊">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/08/21/2019-08-21-%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" class="post-title-link" itemprop="url">排序算法总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-08-21 00:00:00" itemprop="dateCreated datePublished" datetime="2019-08-21T00:00:00+08:00">2019-08-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="0x01-排序的基本概念"><a href="#0x01-排序的基本概念" class="headerlink" title="0x01    排序的基本概念"></a>0x01    排序的基本概念</h3><h4 id="1-1-定义"><a href="#1-1-定义" class="headerlink" title="1.1    定义"></a>1.1    定义</h4><p>排序：重新排列表中的元素，使表中的元素满足按照关键字递增或递减的过程</p>
<h4 id="1-2-算法稳定性"><a href="#1-2-算法稳定性" class="headerlink" title="1.2    算法稳定性"></a>1.2    算法稳定性</h4><p>算法稳定性：若待排序表中有两个元素R<del>i</del>和R<del>j</del>，其对应的关键字key<del>i</del>=key<del>j</del>，且在排序前R<del>i</del>在R<del>j</del>的前面，若使用某一排序算法排序后，R<del>i</del>仍然在R<del>j</del>前面，则称这个算法是稳定的，否则为不稳定的。</p>
<p>（tips：算法的稳定性和我们正常理解的稳定不稳定概念不一样！！！）</p>
<blockquote>
<p>这里举一个简单的例子来说明算法稳定性的概念</p>
<p>如果对数组[1,2,3<del>1</del>,4,3<del>2</del>,5]排序</p>
<p>我们调用某排序算法对其排序</p>
<p>注意这里面有两个相同的3，我们这里记为3<del>1</del>  3<del>2</del></p>
<p>如果排序完结果为[1,2,3<del>1</del>,3<del>2</del>,4,5],即没有改变两个3的相对位置，我们则称这个排序算法是稳定的</p>
<p>如果结果是[1,2,3<del>2</del>,3<del>1</del>,4,5]，则不稳定</p>
</blockquote>
<p>算法是否具有稳定性并不能衡量这个算法的优劣，只是对算法性质的描述</p>
<p>对于不稳定的排序算法，只需举出一组关键字的实例，说明它的不稳定即可</p>
<p>稳定的排序算法：冒泡排序、插入排序、归并排序、基数排序</p>
<p>不稳定的排序算法：选择排序、快速排序、希尔排序、堆排序</p>
<h4 id="1-3-排序算法分类"><a href="#1-3-排序算法分类" class="headerlink" title="1.3    排序算法分类"></a>1.3    排序算法分类</h4><p>在排序过程中，根据<strong>数据元素是否完全在内存中</strong>，可将排序算法分为两类：</p>
<blockquote>
<p>内部排序：排序期间元素全部存放在内存中的排序</p>
<p>外部排序：排序期间元素无法全部同时存放在内存中，必须在排序过程中根据要求不断地在内外存之间移动</p>
</blockquote>
<p>一般情况下，内部排序算法在执行过程中都要经过两种操作：比较和移动。通过比较两个关键字，确定对应元素的前后关系，然后移动元素达到有序。</p>
<p>并非所有内部排序都要基于比较，如基数排序</p>
<p>内部排序算法的性能取决于算法的时间复杂度和空间复杂度</p>
<h3 id="0x02-插入排序"><a href="#0x02-插入排序" class="headerlink" title="0x02    插入排序"></a>0x02    插入排序</h3><blockquote>
<p>插入排序(Insertion Sort)的基本思想是每次将一个待排序的记录按其关键字大小插入到前面已排好序的子序列中，直到全部记录插入完成。</p>
</blockquote>
<h4 id="2-1-直接插入排序"><a href="#2-1-直接插入排序" class="headerlink" title="2.1    直接插入排序"></a>2.1    直接插入排序</h4><h5 id="2-1-1代码实现"><a href="#2-1-1代码实现" class="headerlink" title="2.1.1代码实现"></a>2.1.1代码实现</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InsertSort</span><span class="params">(ElemType A[],<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,j;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">2</span>;i&lt;=n;i++)&#123;	<span class="comment">//将A[1]看成有序数列，对2--n上的数依次插入</span></span><br><span class="line">        <span class="keyword">if</span>(A[i].key&lt;A[i<span class="number">-1</span>].key)&#123;</span><br><span class="line">            A[<span class="number">0</span>]=A[i];	<span class="comment">//A[0]为哨兵元素，作为辅助单元，不属于排序结果</span></span><br><span class="line">            <span class="keyword">for</span>(j=i<span class="number">-1</span>;A[<span class="number">0</span>].key&lt;A[j].key;j--)&#123;	<span class="comment">//从后往前进行比较</span></span><br><span class="line">                A[j+<span class="number">1</span>]=A[j];	<span class="comment">//将大的元素向后移位</span></span><br><span class="line">            &#125;</span><br><span class="line">            A[j+<span class="number">1</span>]=A[<span class="number">0</span>];	<span class="comment">//找到插入位置</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-1-2-性能分析"><a href="#2-1-2-性能分析" class="headerlink" title="2.1.2    性能分析"></a>2.1.2    性能分析</h5><p>空间效率：使用常数个辅助单元，时间复杂度为O(1)</p>
<p>时间效率：取决于待排序表的初始状态</p>
<p>最好的情况是待排序的表本身就是有序的，如{2,3,4,5,6}，比较次数则是n−1次，然后不需要进行移动，时间复杂度是O(n)。</p>
<p>最差的情况就是待排序表是逆序的情况，如{6,5,4,3,2},此时需要比较$\sum_{i=2}^{n}{i}$次，而记录的移动次数也达到最大值$\sum_{i=2}^{n}{i+1}$次。</p>
<p>如果排序记录是随机的，那么根据概率相同的原则，平均比较和移动次数约为$\frac{n^2}{4}$。</p>
<p>因此，可以得出直接插入排序算法的时间复杂度是O(n^2^)。同时也可以看出，直接插入排序算法会比冒泡排序和简单选择排序算法的性能要更好一些。</p>
<p>tips:虽然折半插入排序时间复杂度也为O(n^2^),但对于数据量比较小的排序表，折半查找表现出更好的性能</p>
<h5 id="2-1-3-稳定性"><a href="#2-1-3-稳定性" class="headerlink" title="2.1.3    稳定性"></a>2.1.3    稳定性</h5><p>是稳定的排序方法</p>
<h5 id="2-1-4"><a href="#2-1-4" class="headerlink" title="2.1.4"></a>2.1.4</h5><p>适用于顺序存储和链式存储的线性表。</p>
<p>链式存储时，可以从前往后查找指定元素的位置。</p>
<p>注意：大部分排序算法都仅适用于顺序存储的线性表</p>
<h4 id="2-2-折半插入排序"><a href="#2-2-折半插入排序" class="headerlink" title="2.2    折半插入排序"></a>2.2    折半插入排序</h4><h5 id="2-2-1-思路"><a href="#2-2-1-思路" class="headerlink" title="2.2.1 思路"></a>2.2.1 思路</h5><p>在直接插入排序中，每次插入都进行了两项工作：</p>
<blockquote>
<ol>
<li>从前面的子表中查找出待插入元素应该被插入的位置</li>
<li>给插入位置腾出空间，将待插入元素复制到表中的插入位置</li>
</ol>
</blockquote>
<p>折半插入将比较和移动操作分离，即先折半查找出元素的待插入位置，然后统一地移动待插入位置之后的所有元素。</p>
<h5 id="2-2-2-代码实现"><a href="#2-2-2-代码实现" class="headerlink" title="2.2.2    代码实现"></a>2.2.2    代码实现</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InsertSort2</span><span class="params">(ElemType A[],<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,j,low,high,mid;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        A[<span class="number">0</span>] = A[i];</span><br><span class="line">        low = <span class="number">1</span>;</span><br><span class="line">        high = i<span class="number">-1</span>;</span><br><span class="line">        #折半查找要插入的位置</span><br><span class="line">        <span class="keyword">while</span>(low&lt;=high)&#123;</span><br><span class="line">            mid = (low+high)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(A[mid].key&gt;A[<span class="number">0</span>].key)&#123;</span><br><span class="line">                high = mid<span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                low = mid+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        #统一后移元素</span><br><span class="line">        <span class="keyword">for</span>(j=i<span class="number">-1</span>;j&gt;=high+<span class="number">1</span>;j--)&#123;</span><br><span class="line">            A[j+<span class="number">1</span>]=A[j];</span><br><span class="line">        &#125;</span><br><span class="line">        #插入本轮所要排序的元素</span><br><span class="line">        A[high+<span class="number">1</span>]=A[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-2-3-性能分析"><a href="#2-2-3-性能分析" class="headerlink" title="2.2.3    性能分析"></a>2.2.3    性能分析</h5><p>折半查找仅减少了比较元素的次数，约为O(nlog<del>2</del>n)；</p>
<p>该比较与待排序表的初始状态无关，仅取决于表中元素个数n；</p>
<p>而元素的移动次数并未改变，它依赖于待排序表的初始状态，因此折半插入排序的时间复杂度仍为O(n^2^)</p>
<p>折半插入排序是稳定的排序方法</p>
<h4 id="2-3-希尔排序"><a href="#2-3-希尔排序" class="headerlink" title="2.3    希尔排序"></a>2.3    希尔排序</h4><p>又称缩小增量排序</p>
<h5 id="2-3-1-基本思想"><a href="#2-3-1-基本思想" class="headerlink" title="2.3.1    基本思想"></a>2.3.1    基本思想</h5><p>先将待排序表分割成若干形如L[i,i+d,i+2d,···,i+kd]的特殊子表，分别进行直接插入排序，当整个表中的元素已呈”基本有序“时，再对全体记录进行一次直接插入排序</p>
<p>这里的<strong>基本有序是指小的关键字基本在前面，大的基本在后面，不大不小的在中间。</strong>像{2,1,3,6,4,7,5,8,9}可以称为基本有序</p>
<p>这里的关键就是如何进行分割，希尔排序采取的是<strong>跳跃分割的策略：将相距某个“增量”的记录组成一个子序列，这样才能保证在子序列内分别进行直接插入排序后得到的结果是基本有序而不是局部有序。</strong></p>
<h5 id="2-3-2-代码实现"><a href="#2-3-2-代码实现" class="headerlink" title="2.3.2    代码实现"></a>2.3.2    代码实现</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ShellSort</span><span class="params">(ElemType A[],<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(dk=n/<span class="number">2</span>;dk&gt;<span class="number">1</span>;dk=dk/<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(i=dk+<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(A[i].key&lt;A[i-dk].key)&#123;</span><br><span class="line">                A[<span class="number">0</span>] = A[i];</span><br><span class="line">                <span class="keyword">for</span>(j=i-dk;j&gt;<span class="number">0</span>&amp;&amp;A[<span class="number">0</span>].key&lt;A[j].key;j-=dk)&#123;</span><br><span class="line">                    A[j+dk] = A[j];</span><br><span class="line">                &#125;</span><br><span class="line">                A[j+dk]=A[<span class="number">0</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-3-3-性能分析"><a href="#2-3-3-性能分析" class="headerlink" title="2.3.3    性能分析"></a>2.3.3    性能分析</h5><p>空间效率：O(1)</p>
<p>时间效率：当n在某个特定范围时为O(n^1.3^),最坏情况下O(n^2^)</p>
<p>稳定性：不稳定</p>
<p>适用性：仅适用于顺序存储的线性表</p>
<h3 id="0x03-交换排序"><a href="#0x03-交换排序" class="headerlink" title="0x03    交换排序"></a>0x03    交换排序</h3><p>根据序列中两个关键字的比较结果来交换着两个记录在序列中的位置。</p>
<h4 id="3-1-冒泡排序"><a href="#3-1-冒泡排序" class="headerlink" title="3.1    冒泡排序"></a>3.1    冒泡排序</h4><h5 id="3-1-1-基本思想"><a href="#3-1-1-基本思想" class="headerlink" title="3.1.1    基本思想"></a>3.1.1    基本思想</h5><p>两两比较相邻记录的关键字，如果反序则交换，直到没有反序的记录为止。</p>
<h5 id="3-1-2-代码实现"><a href="#3-1-2-代码实现" class="headerlink" title="3.1.2    代码实现"></a>3.1.2    代码实现</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BubbleSort</span><span class="params">(ElemType A[],<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n<span class="number">-1</span>;i++)&#123;</span><br><span class="line">        flag = <span class="literal">false</span>;<span class="comment">//本轮冒泡是否发生交换</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=n<span class="number">-1</span>; j&gt;i; j--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(A[j<span class="number">-1</span>].key&gt;A[j].key)&#123;</span><br><span class="line">                swap(A[j<span class="number">-1</span>],A[j]);</span><br><span class="line">                flag = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(flag = <span class="literal">false</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-1-3-性能分析"><a href="#3-1-3-性能分析" class="headerlink" title="3.1.3    性能分析"></a>3.1.3    性能分析</h5><p>空间效率：O(1)</p>
<p>时间效率：最好为O(n)    最差为O(n^2^)    平均为O(n^2^)</p>
<p>稳定性：稳定</p>
<h4 id="3-2-快速排序"><a href="#3-2-快速排序" class="headerlink" title="3.2    快速排序"></a>3.2    快速排序</h4><h5 id="3-2-1-基本思想"><a href="#3-2-1-基本思想" class="headerlink" title="3.2.1    基本思想"></a>3.2.1    基本思想</h5><h5 id="3-2-2-代码实现"><a href="#3-2-2-代码实现" class="headerlink" title="3.2.2    代码实现"></a>3.2.2    代码实现</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QuickSort</span><span class="params">(ElemType A[], <span class="keyword">int</span> low, <span class="keyword">int</span> high)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(low&lt;high)&#123;</span><br><span class="line">        <span class="keyword">int</span> pivotpos = partition(A,low,high);</span><br><span class="line">        QuickSort(A,low,pivotpos<span class="number">-1</span>);</span><br><span class="line">        QuickSort(A,pivotpos+<span class="number">1</span>,high);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">partition</span><span class="params">(ElemType A[], <span class="keyword">int</span> low, <span class="keyword">int</span> high)</span></span>&#123;</span><br><span class="line">    ElemType pivot = A[low];</span><br><span class="line">    <span class="keyword">while</span>(low&lt;high)&#123;</span><br><span class="line">        <span class="keyword">while</span>(low&lt;high &amp;&amp; A[high]&gt;=pivot)   --high;</span><br><span class="line">        A[low] = A[high];</span><br><span class="line">        <span class="keyword">while</span>(low&lt;high &amp;&amp; A[low]&lt;=pivot)    ++low;</span><br><span class="line">        A[high] = A[low];</span><br><span class="line">    &#125;</span><br><span class="line">    A[low] = pivot;</span><br><span class="line">    <span class="keyword">return</span> low;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-2-3-性能分析"><a href="#3-2-3-性能分析" class="headerlink" title="3.2.3    性能分析"></a>3.2.3    性能分析</h5>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">沄渊</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
